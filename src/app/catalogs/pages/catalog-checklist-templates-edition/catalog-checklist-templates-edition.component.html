
<div
  class="container"
  #catalogEdition
  @routingAnimation
  (@routingAnimation.done)="pageAnimationFinished($event)"
>

  <ng-container *ngIf="scroll$ | async"></ng-container>
  <ng-container *ngIf="checklistTemplate$ | async"></ng-container>  
  <ng-container *ngIf="showGoTop$ | async"></ng-container>
  <ng-container *ngIf="sensors$ | async"></ng-container>
  <ng-container *ngIf="templateTypes$ | async"></ng-container>
  <ng-container *ngIf="settingsData$ | async"></ng-container>
  <ng-container *ngIf="macros$ | async"></ng-container>
  <ng-container *ngIf="genYesNoValues$ | async"></ng-container>
  <ng-container *ngIf="notifyingModes$ | async"></ng-container>  
  <ng-container *ngIf="notifyingChannels$ | async"></ng-container>  
  <ng-container *ngIf="toolbarClick$ | async "></ng-container>  
  <ng-container *ngIf="toolbarAnimationFinished$ | async "></ng-container>  
  <ng-container *ngIf="parameters$ | async "></ng-container>  
  <ng-container *ngIf="translations$ | async "></ng-container>  
  <ng-container *ngIf="updateChecklistTemplate$ | async "></ng-container>    
  <ng-container *ngIf="deleteChecklistTemplateTranslations$ | async "></ng-container>      
  <ng-container *ngIf="addChecklistTemplateTranslations$ | async "></ng-container>   
  <ng-container *ngIf="updateChecklistTemplateCatalog$ | async "></ng-container>      
  <ng-container *ngIf="duplicateAttachmentsList$ | async "></ng-container>        
  <ng-container *ngIf="molds$ | async "></ng-container>       

  <div @dissolve class="sticky" *ngIf="showMacros">
    <mat-card>
      <div class="card-macros">
        <div
          class="macro-element"  
          *ngFor="let macro of macros.items; let i = index"
          [innerHTML]="macro.friendlyText"
        >        
        </div>      
      </div>
      <mat-divider style="margin: 0px 10px 5px 10px;"></mat-divider>
      <div style="padding: 0px 10px 10px 10px;"><strong>Inserte en el campo el id de la macro incluyendo los corchetes. Estas macros serán sustituidas por su valor correspondiente al momento de generar el checklist.</strong></div>
    </mat-card>  
  </div>

  <mat-card class="card">
    <form
        class="layout"
        (ngSubmit)="onSubmit()"
        [formGroup]="checklistTemplateForm"
        #f="ngForm"
      >
      <mat-accordion multi>
        <mat-expansion-panel
          (opened)="panelOpenState[0] = true"
          (closed)="panelOpenState[0] = false"
          hideToggle="true"
          [expanded]="panelOpenState[0]"
        >
          <mat-expansion-panel-header
            [collapsedHeight]="'55px'"
            [ngStyle]="{
              'background-color': panelOpenState[0]
                ? 'var(--z-colors-page-shadow)'
                : 'var(--z-colors-page-card-background-color)'
            }"
          >
            <mat-panel-title>
              <mat-icon class="accordion-icon" [svgIcon]="catalogIcon">
              </mat-icon>
              <label class="accordion-label"
                >INFORMACIÓN PRINCIPAL DE LA PLANTILLA DE CHECKLIST</label
              >
            </mat-panel-title>
            <div class="icon-button-container">
              <button
                mat-icon-button
                class="icon-button open"
                aria-label="icon-button with menu icon"
              >
                <mat-icon class="icon-button">
                  {{
                    panelOpenState[0]
                      ? "keyboard_arrow_up"
                      : "keyboard_arrow_down"
                  }}
                </mat-icon>
              </button>
            </div>
          </mat-expansion-panel-header>
          <div class="grid-multiple margin-top">
            <div class="field-items">
              <mat-icon
                class="macros-icon"
                svgIcon="transcode"
                matTooltip="Este campo soporta macros"
                matTooltipClass="tooltip-general"
                matTooltipShowDelay="100"
              >
              </mat-icon>              
              <app-input-field
                [focused]="focusThisField==='name'"
                [bordered]="true"
                [formField]="checklistTemplateForm.controls.name"
                leftHint="Campo requerido"
                [fieldMaxLength]="300"
                [showRightHint]="true"
                currentErrorMessage="Este campo no puede estar vacío"
                currentErrorIcon="warn-line"
                [showCloseButton]="true"
                fieldHelp="Especifique el nombre asignadoa la variable"
                [initialFocus]="true"                
              >
                <span fieldTitle class="label field__label"
                  >Descripción/Nombre del checklist</span
                >
              </app-input-field>
            </div>
            <div class="field-items">
              <app-input-field
                [focused]="focusThisField==='prefix'"
                [bordered]="true"
                [formField]="checklistTemplateForm.controls.prefix"
                leftHint="Campo requerido"
                [fieldMaxLength]="50"
                [showRightHint]="true"                
                [showCloseButton]="true"
                fieldHelp="Especifique la abreviación de la variable"
                [initialFocus]="true"                
              >
                <span fieldTitle class="label field__label"
                  >Abreviación de la variable</span
                >
              </app-input-field>
            </div>
            <div class="field-items">
              <app-input-field
                [bordered]="true"
                [formField]="checklistTemplateForm.controls.reference"
                leftHint="Campo opcional"
                [fieldMaxLength]="100"
                [showRightHint]="true"
                [showCloseButton]="true"
                fieldHelp="Especifique la referencia de la variable"
              >
                <span fieldTitle class="label field__label"
                  >Referencia</span
                >
              </app-input-field>
            </div>
            <div class="field-items field-items--bordered">
              <app-area-field
                [bordered]="false"
                [formField]="checklistTemplateForm.controls.notes"
                [fieldMaxLength]="500"
                [showRightHint]="true"
                [showCloseButton]="true"
                [minRows]="1"
                [maxRows]="5"
                fieldHelp="Especifique las notas referentes a esta variable"
              >
                <span fieldTitle class="label field__label"
                  >Notas referentes a la variable</span
                >
              </app-area-field>               
            </div>                     
            <div class="field-items">
              <fieldset class="field__container">
                <div class="image-and-field">
                  <div class="field-components">
                    <span class="label field__label">Imagen a mostrar</span>                
                    <mat-form-field appearance="fill" class="field__field">
                      <input
                        class="field__input"
                        matInput
                        [formControl]="checklistTemplateForm.controls.mainImageName"                        
                        [readonly]="true"
                      />
                      <input type="file" style="display: none" (change)="onFileSelected($event)" accept="*.png,*.jpg,*.jpeg,*.svg,*.bmp" #fileInput> 
                      <button
                        matSuffix
                        mat-icon-button
                        (click)="fileInput.click()"
                        style="margin-right: 5px;"
                        matTooltip="Abre la ventana de dialogo para buscar un archivo tipo imagen"
                        matTooltipClass="tooltip-general"
                        matTooltipShowDelay="100"
                      >
                        <mat-icon>search</mat-icon>
                      </button>
                      <button
                        *ngIf="checklistTemplate.mainImage"
                        matSuffix
                        mat-icon-button
                        (click)="removeImage()"
                        style="margin-right: 5px;"
                        matTooltip="Remueve la imagen de la variable"
                        matTooltipClass="tooltip-general"
                        matTooltipShowDelay="100"
                      >
                        <mat-icon>close</mat-icon>
                      </button>
                    </mat-form-field>          
                    <span class="field__help">Busque en su disco la imagen que se mostrará en las vistas de esta variable</span>
                  </div>                  
                  <div *ngIf="!loading" class="card-image">
                    <div
                      class="image-container"
                      *ngIf="this.checklistTemplate.mainImage"
                    >
                      <img                
                        @dissolve
                        appImageNotFound                
                        class="variable-image"                        
                        [src]="this.checklistTemplate.mainImage"
                        [alt]="this.checklistTemplate.mainImage"            
                        fill
                      >      
                    </div>
                    <div
                      *ngIf="!this.checklistTemplate.mainImage"
                      class="icon-container-image"
                    >
                      <mat-icon class="default-icon" [svgIcon]="catalogIcon"></mat-icon>
                    </div>    
                  </div>
                </div>                
              </fieldset>              
            </div>
            <div class="field-items">
              <fieldset
                class="field__container"
                style="min-width: 350px; height: calc(100% - 22px);"
                [ngClass]="{
                  'field__container--error':
                    checklistTemplateForm.controls.templateType.touched &&
                    !checklistTemplateForm.controls.templateType.valid
                }"
                [disabled]="checklistTemplateForm.controls.templateType.disabled"
              >
                <div class="title-with-id">
                  <span class="label field__label">Tipo de plantilla de checklist</span>
                  <span class="field__label" *ngIf="checklistTemplateForm.controls.templateType?.value?.id">id: {{ checklistTemplateForm.controls.templateType?.value?.id }}</span>
                </div>
                <app-auto-complete-field
                  [focused]="focusThisField==='templateType'"
                  [formField]="checklistTemplateForm.controls.templateType"
                  [list]="templateTypes.items"
                  [totalCount]="templateTypes.totalCount"
                  leftHint="Escriba el Tipo de molde"
                  [catalog]="SystemTables.MOLD_TYPES"
                  [loading]="templateTypes.loading"
                  noItemsError="No hay Tipos de molde con este nombre"
                  [showDataState]="true"
                  (optionSelected)="handleOptionSelected($event)"
                  (getMoreData)="getMoreData($event)"
                >
                </app-auto-complete-field>
                <span class="field__help">Especifique el Tipo de plantilla de checklist</span>
              </fieldset>
            </div>            
          </div>          
        </mat-expansion-panel>
        <mat-expansion-panel
          (opened)="panelOpenState[1] = true"
          (closed)="panelOpenState[1] = false"
          hideToggle="true"
          [expanded]="panelOpenState[1]"
        >
          <mat-expansion-panel-header
            [collapsedHeight]="'55px'"
            [ngStyle]="{
              'background-color': panelOpenState[1]
                ? 'var(--z-colors-page-shadow)'
                : 'var(--z-colors-page-card-background-color)'
            }"
          >
            <mat-panel-title>
              <mat-icon class="accordion-icon" svgIcon="time"> </mat-icon>
              <label class="accordion-label">USO GENERAL DEL TEMPLATE DE CHECKLIST</label>
            </mat-panel-title>
            <div class="icon-button-container">
              <button
                mat-icon-button
                class="icon-button open"
                aria-label="icon-button with menu icon"
              >
                <mat-icon class="icon-button">
                  {{
                    panelOpenState[1]
                      ? "keyboard_arrow_up"
                      : "keyboard_arrow_down"
                  }}
                </mat-icon>
              </button>
            </div>
          </mat-expansion-panel-header>
          <div class="grid-multiple margin-top">            
            <div class="field-items">
              <app-select-field
                [formField]="checklistTemplateForm.controls.allowDiscard"
                [list]="genYesNoValues.items"                
                fieldHelp="Especifique si el checklist permite descartar el llenado"
              >
                <span fieldTitle class="label field__label"
                  >¿El checklist permite descartar el llenado?</span
                >
              </app-select-field>                
            </div>
            <div class="field-items">
              <app-select-field
                [formField]="checklistTemplateForm.controls.allowRejection"
                [list]="genYesNoValues.items"                
                fieldHelp="Especifique si el checklist permite ser rechazado"
              >
                <span fieldTitle class="label field__label"
                  >¿El checklist permite ser rechazado?</span
                >
              </app-select-field>                
            </div>
            <div class="field-items">
              <app-select-field
                [formField]="checklistTemplateForm.controls.allowManualMode"
                [list]="genYesNoValues.items"                
                fieldHelp="Especifique si el checklist permite modo manual"
              >
                <span fieldTitle class="label field__label"
                  >¿El checklist permite modo manual?</span
                >
              </app-select-field>                
            </div>
            <div class="field-items">
              <app-select-field
                [formField]="checklistTemplateForm.controls.allowPartialSaving"
                [list]="genYesNoValues.items"                
                fieldHelp="Especifique si el checklist permite el guardado parcial"
              >
                <span fieldTitle class="label field__label"
                  >¿El checklist permite guardado parcial?</span
                >
              </app-select-field>                
            </div>
            <div class="field-items">
              <app-select-field
                [formField]="checklistTemplateForm.controls.allowApprovalByGroup"
                [list]="genYesNoValues.items"                
                fieldHelp="Especifique si el checklist permite ser aprobado por el grupo"
              >
                <span fieldTitle class="label field__label"
                  >¿El checklist permite ser aprobado por el grupo?</span
                >
              </app-select-field>                
            </div>
            <div class="field-items">
              <app-select-field
                [formField]="checklistTemplateForm.controls.allowExpiring"
                [list]="genYesNoValues.items"                
                fieldHelp="Especifique si el checklist permite  expiración"
              >
                <span fieldTitle class="label field__label"
                  >¿El checklist expira?</span
                >
              </app-select-field>                
            </div>            
            <div class="field-items">
              <app-select-field
                [formField]="checklistTemplateForm.controls.allowApprovalByGroup"
                [list]="genYesNoValues.items"                
                fieldHelp="Especifique si el checklist permite ser aprobado por el grupo"
              >
                <span fieldTitle class="label field__label"
                  >¿El checklist permite ser aprobado por el grupo?</span
                >
              </app-select-field>                
            </div>            
          </div>
        </mat-expansion-panel>
        <mat-expansion-panel
          (opened)="panelOpenState[2] = true"
          (closed)="panelOpenState[2] = false"
          hideToggle="true"
          [expanded]="panelOpenState[2]"
        >
          <mat-expansion-panel-header
            [collapsedHeight]="'55px'"
            [ngStyle]="{
              'background-color': panelOpenState[2]
                ? 'var(--z-colors-page-shadow)'
                : 'var(--z-colors-page-card-background-color)'
            }"
          >
            <mat-panel-title>
              <mat-icon class="accordion-icon" svgIcon="treasure-chest"> </mat-icon>
              <label class="accordion-label">MOLDES ASOCIADOS</label>
            </mat-panel-title>
            <div class="icon-button-container">
              <button
                mat-icon-button
                class="icon-button open"
                aria-label="icon-button with menu icon"
              >
                <mat-icon class="icon-button">
                  {{
                    panelOpenState[2]
                      ? "keyboard_arrow_up"
                      : "keyboard_arrow_down"
                  }}
                </mat-icon>
              </button>
            </div>
          </mat-expansion-panel-header>
          <div class="grid-multiple margin-top">            
            <div class="field-items">
              <app-multiple-selection-list
                [bordered]="false"
                [showSelect]="true"                  
                [selectOptions]="moldsOptions"
                [currentSelections]="moldsCurrentSelection"        
                [formField]="checklistTemplateForm.controls.molds"
                [list]="molds.items"
                [totalCount]="molds.totalCount"
                [loading]="molds.loading"                                    
                [catalog]="SystemTables.MOLDS"      
                placeHolder="Filtrar..."
                [defaultValue]="multipleSearchDefaultValue"            
                (multipleSelectionChanged)="handleMultipleSelectionChanged($event)"
                (getMoreData)="getMoreData($event)"
              >
              <span fieldTitle class="label field__label">Moldes donde se puede aplicar este checklist</span>
              </app-multiple-selection-list>                
            </div>
          </div>
        </mat-expansion-panel> 
        <mat-expansion-panel
          (opened)="panelOpenState[3] = true"
          (closed)="panelOpenState[3] = false"
          hideToggle="true"
          [expanded]="panelOpenState[3]"
        >
          <mat-expansion-panel-header
            [collapsedHeight]="'55px'"
            [ngStyle]="{
              'background-color': panelOpenState[3]
                ? 'var(--z-colors-page-shadow)'
                : 'var(--z-colors-page-card-background-color)'
            }"
          >
            <mat-panel-title>
              <mat-icon class="accordion-icon" svgIcon="announcements"> </mat-icon>
              <label class="accordion-label">NOIFICACIONES</label>
            </mat-panel-title>
            <div class="icon-button-container">
              <button
                mat-icon-button
                class="icon-button open"
                aria-label="icon-button with menu icon"
              >
                <mat-icon class="icon-button">
                  {{
                    panelOpenState[3]
                      ? "keyboard_arrow_up"
                      : "keyboard_arrow_down"
                  }}
                </mat-icon>
              </button>
            </div>
          </mat-expansion-panel-header>
          <div class="grid-multiple margin-top">            
            <div class="field-items">
              <app-select-field
                [formField]="checklistTemplateForm.controls.notifyExpiring"
                [list]="genYesNoValues.items"                
                fieldHelp="Especifique si el checklist notifica la expiración"
              >
                <span fieldTitle class="label field__label"
                  >¿El checklist notifica la expiración?</span
                >
              </app-select-field>                
            </div>
            <div class="field-items">
              <fieldset
                class="multiple-selection-list__field-container"
                [disabled]="checklistTemplateForm.controls.notifyExpiring.value !== 'y'"                
              >
                <span class="label field__label">Modo de notificación</span>
                <div
                  class="multiple-selection-list__list-options-container"
                  [ngStyle]="{
                    'border-color':
                    checklistTemplateForm.controls.notifyExpiring.value !== 'y'
                        ? 'var(--z-colors-page-button-disabled-border)'
                        : 'var(--theme-primary-300)'
                  }"
                >
                  <div
                    *ngIf="loading"
                    class="multiple-selection-list__progress-container"
                  >
                    <mat-progress-spinner
                      mode="indeterminate"
                      color="primary"
                      class="multiple-selection-list__progress"
                      diameter="64"
                    >
                    </mat-progress-spinner>
                  </div>
                  <div          
                    class="multiple-selection-list__list-options-box no-selections"
                    *ngIf="notifyingModes.items.length === 0 && !loading"
                  >
                    <span>No hay elementos a mostrar...</span>
                  </div>
                  <mat-selection-list
                    *ngIf="notifyingModes.items.length > 0 || loading"
                    class="multiple-selection-list__list-options-box"
                    [disabled]="
                      checklistTemplateForm.controls.notifyExpiring.value !== 'y'
                    "
                    name="multipleSelection"
                    (click)="handleChengeSelection($event)"                    
                    (keydown)="handleKeyDown($event)"
                    cdkScrollable
                  >
                    <mat-list-option
                      *ngFor="let item of notifyingModes.items; let i = index"            
                      [value]="item.id"
                      (click)="handleNotifyModesSelectItem(checklistTemplateForm.controls.notifyExpiring, item)"
                      (keydown)="handleKeyDown($event)"
                      [selected]="!!item.selected"
                      checkboxPosition="before"
                      
                      color="primary"
                    >
                      <div class="multiple-selection-list__list-option-container">
                        <div class="multiple-selection-list__list-option">
                          {{ item.friendlyText }}
                        </div>
                      </div>
                    </mat-list-option>
                  </mat-selection-list>
                </div>
                <div
                  class="multiple-selection-list__search-container"        
                >
                  <mat-hint
                    class="auto-complete__hint"
                    align="start"          
                  >
                    <span
                      *ngIf="notifyingModes.items.length > 0"
                      class="auto-complete__hint--normal"
                    >
                      Item(s): {{ notifyingModes.items.length }}
                    </span>
                    <span 
                      *ngIf="notifyingModes.items.length === 0"
                      class="auto-complete__hint--normal"
                    >
                      No hay items a mostrar...
                    </span>
                  </mat-hint>
                  <mat-hint
                    class="auto-complete__hint"
                    align="end"          
                  >
                    <span class="auto-complete__hint--normal">
                        Seleccionados en la lista: {{ notifyingModesSelected }}
                    </span>
                  </mat-hint>
                </div>
              </fieldset>
            </div>
            <div class="field-items">
              <fieldset
                class="multiple-selection-list__field-container"
                [disabled]="checklistTemplateForm.controls.notifyExpiring.value !== 'y'"                
              >
                <span class="label field__label">Canal de notificación</span>
                <div
                  class="multiple-selection-list__list-options-container"
                  [ngStyle]="{
                    'border-color':
                    checklistTemplateForm.controls.notifyExpiring.value !== 'y'
                        ? 'var(--z-colors-page-button-disabled-border)'
                        : 'var(--theme-primary-300)'
                  }"
                >
                  <div
                    *ngIf="loading"
                    class="multiple-selection-list__progress-container"
                  >
                    <mat-progress-spinner
                      mode="indeterminate"
                      color="primary"
                      class="multiple-selection-list__progress"
                      diameter="64"
                    >
                    </mat-progress-spinner>
                  </div>
                  <div          
                    class="multiple-selection-list__list-options-box no-selections"
                    *ngIf="notifyingChannels.items.length === 0 && !loading"
                  >
                    <span>No hay elementos a mostrar...</span>
                  </div>
                  <mat-selection-list
                    *ngIf="notifyingChannels.items.length > 0 || loading"
                    class="multiple-selection-list__list-options-box"
                    [disabled]="
                      checklistTemplateForm.controls.notifyExpiring.value !== 'y'
                    "
                    name="multipleSelection"
                    (click)="handleChengeSelection($event)"                    
                    (keydown)="handleKeyDown($event)"
                    cdkScrollable
                  >
                    <mat-list-option
                      *ngFor="let item of notifyingChannels.items; let i = index"            
                      [value]="item.id"
                      (click)="handleNotifyChannelsSelectItem(checklistTemplateForm.controls.notifyExpiring, item)"
                      (keydown)="handleKeyDown($event)"
                      [selected]="!!item.selected"
                      checkboxPosition="before"
                      
                      color="primary"
                    >
                      <div class="multiple-selection-list__list-option-container">
                        <div class="multiple-selection-list__list-option">
                          {{ item.friendlyText }}
                        </div>
                      </div>
                    </mat-list-option>
                  </mat-selection-list>
                </div>
                <div
                  class="multiple-selection-list__search-container"        
                >
                  <mat-hint
                    class="auto-complete__hint"
                    align="start"          
                  >
                    <span
                      *ngIf="notifyingChannels.items.length > 0"
                      class="auto-complete__hint--normal"
                    >
                      Item(s): {{ notifyingChannels.items.length }}
                    </span>
                    <span 
                      *ngIf="notifyingChannels.items.length === 0"
                      class="auto-complete__hint--normal"
                    >
                      No hay items a mostrar...
                    </span>
                  </mat-hint>
                  <mat-hint
                    class="auto-complete__hint"
                    align="end"          
                  >
                    <span class="auto-complete__hint--normal">
                        Seleccionados en la lista: {{ notifyingChannelsSelected }}
                    </span>
                  </mat-hint>
                </div>
              </fieldset>
            </div>
            <div class="field-items field-items--bordered">
              <mat-icon
                class="macros-icon"
                svgIcon="transcode"
                matTooltip="Este campo soporta macros"
                matTooltipClass="tooltip-general"
                matTooltipShowDelay="100"
              >
              </mat-icon>              
              <app-area-field
                [bordered]="false"
                [formField]="checklistTemplateForm.controls.expiringMessageBody"
                [fieldMaxLength]="1000"
                [showRightHint]="true"
                [showCloseButton]="true"
                [minRows]="1"
                [maxRows]="5"
                fieldHelp="Especifique el mensaje que se enviará"
              >
                <span fieldTitle class="label field__label"
                  >Notificación a enviar cuando expire el checklist</span
                >
              </app-area-field>               
            </div>                     
            <div class="field-items field-items--bordered">
              <mat-icon
                class="macros-icon"
                svgIcon="transcode"
                matTooltip="Este campo soporta macros"
                matTooltipClass="tooltip-general"
                matTooltipShowDelay="100"
              >
              </mat-icon>              
              <app-area-field
                [bordered]="false"
                [formField]="checklistTemplateForm.controls.expiringMessageSubject"
                [fieldMaxLength]="200"
                [showRightHint]="true"
                [showCloseButton]="true"
                [minRows]="1"
                [maxRows]="5"
                fieldHelp="Especifique el título de la notificación que se enviará por correo"
              >
                <span fieldTitle class="label field__label"
                  >Título del mensaje a enviar (sólo para envío de correos)</span
                >
              </app-area-field>               
            </div>                     
          </div>
        </mat-expansion-panel>
        <mat-expansion-panel
          (opened)="panelOpenState[4] = true"
          (closed)="panelOpenState[4] = false"
          hideToggle="true"
          [expanded]="panelOpenState[4]"
        >
          <mat-expansion-panel-header
            [collapsedHeight]="'55px'"
            [ngStyle]="{
              'background-color': panelOpenState[4]
                ? 'var(--z-colors-page-shadow)'
                : 'var(--z-colors-page-card-background-color)'
            }"
          >
            <mat-panel-title>
              <mat-icon class="accordion-icon" svgIcon="attachment"> </mat-icon>
              <label class="accordion-label">ADJUNTOS DEL DE LA PLANTILLA DE CHECKLIST / CABECERA ({{ checklistTemplate.attachments.length }} de un máximo de {{ settingsData?.attachments?.checklistTemplateHeader ?? 10 }})</label>
            </mat-panel-title>
            <div class="icon-button-container">
              <button
                mat-icon-button
                class="icon-button open"
                aria-label="icon-button with menu icon"
              >
                <mat-icon class="icon-button">
                  {{
                    panelOpenState[4]
                      ? "keyboard_arrow_up"
                      : "keyboard_arrow_down"
                  }}
                </mat-icon>
              </button>
            </div>
          </mat-expansion-panel-header>
          <div class="grid-multiple margin-top">            
            <div class="field-items">              
              <div            
                class="values-table values-table__container"    
              >              
                <table mat-table [dataSource]="attachmentsTable">

                  <ng-container matColumnDef="index">
                    <th mat-header-cell *matHeaderCellDef>#</th>                  
                    <td mat-cell *matCellDef="let row; let i = index">
                      <ng-container>{{ i + 1 }}</ng-container>                        
                    </td>
                  </ng-container>

                  <ng-container matColumnDef="icon">
                    <th mat-header-cell *matHeaderCellDef>Aplicación</th>
                    <td mat-cell *matCellDef="let row">
                      <div class="card-image-icon">
                        <div
                          class="image-container-table"
                          *ngIf="row.icon === 'field_image'"
                        >
                          <img                
                            @dissolve
                            appImageNotFound                
                            class="variable-image"                        
                            [src]="row.image"
                            [alt]="row.image"         
                            fill
                          >      
                        </div>
                        <div
                          *ngIf="row.icon !== 'field_image'"
                          class="icon-container"
                        >
                          <mat-icon 
                            class="file-type-icon"
                            [svgIcon]="row.icon"
                          >
                          </mat-icon>
                        </div>    
                      </div>                      
                    </td>      
                  </ng-container>

                  <ng-container matColumnDef="name">
                    <th mat-header-cell *matHeaderCellDef>Nombre</th>                  
                    <td mat-cell *matCellDef="let row">
                      <ng-container>{{ row.name }}</ng-container>                        
                    </td>
                  </ng-container>

                  <ng-container matColumnDef="actions-attachments">
                    <th mat-header-cell *matHeaderCellDef>Acciones</th>
                    <td class="general-info" mat-cell *matCellDef="let row; let i = index">
                      <div
                        class="box-row"                          
                      >
                        <button
                          mat-icon-button
                          (click)="handleAttachmentMoveToUp(i)"
                          matTooltip="Sube el item a un orden"
                          matTooltipClass="tooltip-general"
                          matTooltipShowDelay="100"
                          [disabled]="i === 0"
                        >
                          <mat-icon>keyboard_arrow_up</mat-icon>
                        </button>
                        <button
                          mat-icon-button
                          (click)="handleAttachmentMoveToDown(i)"
                          matTooltip="Baja el item a un orden"
                          matTooltipClass="tooltip-general"
                          matTooltipShowDelay="100"
                          [disabled]="i === checklistTemplate.attachments.length - 1"
                        >
                          <mat-icon>keyboard_arrow_down</mat-icon>
                        </button>
                        <button
                          mat-icon-button
                          (click)="handleAttachmentMoveToFirst(i)"
                          matTooltip="Sube el item al primer orden"
                          matTooltipClass="tooltip-general"
                          matTooltipShowDelay="100"
                          [disabled]="i === 0"
                        >
                          <mat-icon>keyboard_capslock</mat-icon>
                        </button>
                        <button
                          mat-icon-button
                          (click)="handleAttachmentMoveToLast(i)"
                          matTooltip="Baja el item al último orden"
                          matTooltipClass="tooltip-general"
                          matTooltipShowDelay="100"
                          [disabled]="i === checklistTemplate.attachments.length - 1"
                        >
                          <mat-icon class="icon-rotated">keyboard_capslock</mat-icon>
                        </button>
                        <button
                          mat-icon-button (click)="handleAttachmentRemove(i)"
                          matTooltip="Elimina este adjunto..."
                          matTooltipClass="tooltip-general"
                          matTooltipShowDelay="100"                          
                        >                          
                          <mat-icon>delete</mat-icon>
                        </button>
                        <button
                          mat-icon-button (click)="handleAttachmentDownload(i)"
                          matTooltip="Descarga a su disco una copia del archivo"
                          matTooltipClass="tooltip-general"
                          matTooltipShowDelay="100"                          
                        >
                          <mat-icon>cloud_download</mat-icon>
                        </button>
                      </div>                        
                    </td>
                  </ng-container>

                  <tr mat-header-row *matHeaderRowDef="attachmentsTableColumns; sticky: 1"></tr>
                  <tr class="table-row" mat-row *matRowDef="let row; columns: attachmentsTableColumns"></tr>
                  
                  <tr class="values-table-mat-row" *matNoDataRow>
                    <td class="values-table__no-data" colspan="9">
                      No hay adjuntos a mostrar...
                    </td>
                  </tr>                  
                </table>                    
              </div>        
              <mat-divider style="margin: 10px 0px 0px 0px;"></mat-divider>
              <div class="grid-multiple-rows no-flex">
                <div class="maintenance-buttons" style="padding: 10px 10px 1px 0px;">
                  <input type="file" style="display: none" (change)="onAttachmentFileSelected($event)" #fileInputAttachment> 
                  <button
                    [disabled]="addAttachmentButtonClick"
                    mat-button
                    class="toolbar-button"
                    aria-label="icon-button with menu icon"
                    matTooltip="Agrega un nuevoadjunto a la variablee"
                    matTooltipClass="tooltip-general"
                    matTooltipShowDelay="100"
                    (click)="(checklistTemplate.attachments.length >= (settingsData?.attachments?.checklistTemplateHeader ?? 10)) ? messageMaxAttchment() : fileInputAttachment.click();"
                  >
                    <mat-icon                                    
                      class="svgicon icon-medium"                
                      svgIcon="document"
                      [ngStyle]="{ visibility: addAttachmentButtonClick ? 'hidden' : 'visible' }"b
                    >
                    </mat-icon>
                    <mat-progress-spinner
                      *ngIf="addAttachmentButtonClick"
                      class="spinner-regular-button"
                      diameter="32"
                      mode="indeterminate"
                    >
                    </mat-progress-spinner>
                    <mat-label class="button-label">Agregar un adjunto...</mat-label>
                  </button>          
                  <button
                    [disabled]="checklistTemplate.attachments.length === 0"
                    mat-button
                    class="toolbar-button warn"
                    aria-label="icon-button with menu icon"
                    matTooltip="Elimina todos los adjuntos"
                    matTooltipClass="tooltip-general"
                    matTooltipShowDelay="100"
                    (click)="handleRemoveAllAttachments()"
                  >
                    <mat-icon                
                      class="svgicon icon-medium"                
                      svgIcon="garbage-can"
                    >
                    </mat-icon>                      
                    <mat-label class="button-label">Eliminar todos los adjuntos...</mat-label>
                  </button>                          
                  <app-label-ellipsis
                    class="readonly-value"
                    style="margin-left: auto"                         
                    [lines]="1"
                    [labelInnerHTML]="checklistTemplateAttachmentLabel"
                  ></app-label-ellipsis>              
                </div>
              </div>      
            </div>
          </div>
        </mat-expansion-panel>   
      </mat-accordion>
    </form>
    <div
      *ngIf="checklistTemplate.id"
      class="catalog-footer"
    >
      <div class="grid-dates">
        <div class="flex">
          <div class="readonly-value item-id">{{ checklistTemplate.id }}</div>
          <div class="label-with-no-index">ID del registro</div>
        </div>
        <div class="flex">
          <div class="readonly-value">{{ _sharedService.convertUtcTolocal(checklistTemplate.createdAt) | date :"medium" }}</div>
          <div class="flex-row">
            <mat-icon class="small-icon" svgIcon="event"></mat-icon>
            <div class="label-with-no-index">Fecha de creación</div>
          </div>
        </div>
        <div class="flex">
          <div class="readonly-value">{{ checklistTemplate.createdBy?.name ?? ScreenDefaultValues.N_A }}</div>
          <div class="flex-row">
            <mat-icon class="small-icon" svgIcon="man"></mat-icon>
            <div class="label-with-no-index">Creado por</div>
          </div>
        </div>
        <div class="flex">
          <div class="readonly-value">{{ _sharedService.convertUtcTolocal(checklistTemplate.updatedAt) | date :"medium" }}</div>
          <div class="flex-row">
            <mat-icon class="small-icon" svgIcon="event"></mat-icon>
            <div class="label-with-no-index">Fecha de modificación</div>
          </div>
        </div>
        <div class="flex">
          <div class="readonly-value">{{ checklistTemplate.updatedBy?.name ?? ScreenDefaultValues.N_A }}</div>
          <div class="flex-row">
            <mat-icon class="small-icon" svgIcon="man"></mat-icon>
            <div class="label-with-no-index">Modificado por</div>
          </div>
        </div>
      </div>
      <mat-divider></mat-divider>
      <div class="grid-inactive" *ngIf="checklistTemplate.status === RecordStatus.INACTIVE">
        <div class="flex">
          <div class="readonly-value">{{ _sharedService.convertUtcTolocal(checklistTemplate.deletedAt) | date :"medium" }}</div>
          <div class="flex-row">
            <mat-icon class="small-icon" svgIcon="event"></mat-icon>
            <div class="label-with-no-index">Fecha de inactivación</div>
          </div>
        </div>
        <div class="flex">
          <div class="readonly-value">{{ checklistTemplate.deletedBy?.name ?? ScreenDefaultValues.N_A }}</div>
          <div class="flex-row">
            <mat-icon class="small-icon" svgIcon="man"></mat-icon>
            <div class="label-with-no-index">Inactivado por</div>
          </div>
        </div>
        <div class="flex-inactive">
          <div class="label-inactive">
            <strong>El registro está INACTIVO</strong>
          </div>
        </div>
      </div>
    </div>
  </mat-card>
</div>